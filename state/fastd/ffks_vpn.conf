# Log to stderr (will be picked up by systemd)
log to stderr level debug2;

hide ip addresses yes;
hide mac addresses yes;

interface "ffks-vpn";

method "salsa2012+gmac";
method "salsa2012+umac";

bind 0.0.0.0:10000;

secret "{{ pillar['minions'][grains['id']]['fastd_secret'].rstrip() }}";

# Set the interface MTU for TAP mode with xsalsa20/aes128 over IPv4 with a base MTU of 1492 (PPPoE)
# (see MTU selection documentation)
mtu 1426;

# Gateway peer configuration, generated by salt
include peers from "gateways";

{% if pillar['minions'][grains['id']].gateway %}
# Node peer configuration (https://github.com/freifunkks/fastd-keys)
include peers from "nodes";
{% endif %}

on up "
  ip link set dev $INTERFACE up address {{ pillar['minions'][grains['id']]['mac'] }}
  ifup $INTERFACE
";

on down "
  ip link set dev $INTERFACE down
  ifdown $INTERFACE
";
